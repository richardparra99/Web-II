<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subir imágenes</title>
</head>
<body>
  <%- include('../components/header') %>

  <div class="container py-3">
    <h1 class="h3">Subir imágenes</h1>

    <% if (typeof flash !== 'undefined' && flash) { %>
      <div class="alert alert-<%= flash.type === 'success' ? 'success' : 'danger' %> alert-dismissible fade show" role="alert">
        <%= flash.text %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
      </div>
    <% } %>

    <form action="/galeria/upload" method="post" enctype="multipart/form-data" class="mt-3">
      <div class="mb-2">
        <input id="photosInput" type="file" class="form-control" name="photos" accept="image/*" multiple />
      </div>
      <button type="submit" class="btn btn-success">Subir</button>
    </form>

    <div id="preview" class="row row-cols-2 row-cols-md-4 g-3 mt-3"></div>
  </div>

  <%- include('../components/footer') %>

  <script>
    // Previsualización de imágenes seleccionadas
    const input   = document.getElementById('photosInput');
    const preview = document.getElementById('preview');

    input.addEventListener('change', () => {
      preview.innerHTML = ''; // limpia previews previos
      const files = Array.from(input.files || []);
      if (!files.length) return;

      files.forEach(file => {
        if (!file.type.startsWith('image/')) return; // ignora no-imágenes

        const url = URL.createObjectURL(file); // blob URL temporal

        const col = document.createElement('div');
        col.className = 'col';
        col.innerHTML = `
          <div class="card h-100">
            <img src="${url}" class="card-img-top" alt="${file.name}">
            <div class="card-body p-2">
              <small class="text-muted">${file.name} · ${(file.size/1024).toFixed(1)} KB</small>
            </div>
          </div>
        `;
        // libera memoria cuando cargue
        col.querySelector('img').onload = () => URL.revokeObjectURL(url);

        preview.appendChild(col);
      });
    });
  </script>
</body>
</html>
